<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>360° Walkthrough</title>
    
    <!-- 
    INSTRUCTIONS:
    1. Place your 360° images in the ./Data/ folder (or change IMAGE_DIR below)
    2. Images should be named "Step 1.jpg", "Step 2.jpg", etc.
    3. If using .png images, change EXT = ".png" in the config below
    4. Run a local server: python3 -m http.server
    5. Open http://localhost:8000 in your browser
    -->
    
    <!-- Google Fonts - Manrope -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200..800&display=swap" rel="stylesheet">
    
    <!-- Preconnect to Cloudflare R2 for faster image loading -->
    <link rel="preconnect" href="https://pub-a901561e98c4422f9a0df782ce967b67.r2.dev" crossorigin>
    
    <!-- Preload A-Frame for faster initialization -->
    <link rel="dns-prefetch" href="https://aframe.io">
    <link rel="preload" as="image" href="https://pub-a901561e98c4422f9a0df782ce967b67.r2.dev/Boomerang_Club_360/floor-3/step-01.jpg" crossorigin fetchpriority="high">
    <link rel="preload" as="image" href="./data/placeholder/Step 1.jpg" fetchpriority="high">
    
    <!-- Styles -->
    <link rel="stylesheet" href="style.css">
    
    <!-- A-Frame CDN -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
</head>
<body>
    <!-- Page Title -->
    <div class="page-title">Boomerang Sports Club, 128</div>
    <div class="pan-instruction">Click and drag to pan</div>
    
    <!-- Right Controls (Comments, Export, Zoom) -->
    <div class="right-controls">
        <button class="add-comment-button" id="add-comment-btn" title="Drop comment (C)">
            <img src="data/icons/comment_icon.png" alt="Add Comment" class="add-comment-icon">
        </button>
        <button class="export-button" id="export-button" title="Export view">
            <img src="data/icons/Export%20Icon.png" alt="Export" class="export-icon">
        </button>
        <button class="zoom-button" id="zoom-in">+</button>
        <div class="zoom-level" id="zoom-level">100%</div>
        <button class="zoom-button" id="zoom-out">−</button>
    </div>
    
    <!-- A-Frame Scene -->
    <a-scene renderer="antialias: true; colorManagement: true; sortObjects: true; physicallyCorrectLights: true; preserveDrawingBuffer: true;" screenshot="width: 1920; height: 1080;">
        <!-- Camera with device orientation support -->
        <a-camera 
            look-controls="touchEnabled: true; magicWindowTrackingEnabled: true"
            position="0 0 0"
            cursor="rayOrigin: mouse">
        </a-camera>
        
        <!-- 360° Image Sky -->
        <a-sky id="sky-image" src="data/placeholder/Step 1.jpg" rotation="0 -90 0" crossorigin="anonymous"></a-sky>
        
        <!-- Comment Pins Container -->
        <a-entity id="comment-pins"></a-entity>
    </a-scene>
    
    <!-- Navigation UI -->
    <div class="nav-ui">
        <button id="prev-btn" class="nav-button" aria-label="Previous step">
            <img src="data/icons/left_arrow.svg" alt="Previous" class="arrow-icon">
        </button>
        <div class="step-indicator" id="step-indicator">Step 1/18</div>
        <button id="next-btn" class="nav-button" aria-label="Next step">
            <img src="data/icons/right_arrow.svg" alt="Next" class="arrow-icon">
        </button>
    </div>
    
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="spinner"></div>
    </div>
    
    <!-- Welcome Instruction Overlay -->
    <div class="welcome-overlay" id="welcome-overlay">
        <div class="welcome-content">
            <div class="welcome-icon">
                <img src="data/icons/click_drag_icon.png" alt="Click and drag" class="welcome-icon-img">
            </div>
            <h2 class="welcome-text">Click and drag to pan in 360°</h2>
            <p class="welcome-hint">Click anywhere to dismiss</p>
        </div>
    </div>
    
    <!-- Connection Error Overlay -->
    <div class="connection-error-overlay" id="connection-error-overlay">
        <div class="connection-error-content">
            <div class="connection-error-icon">⚠️</div>
            <h2 class="connection-error-title">Connection Issue</h2>
            <p class="connection-error-text">Unable to load this step. Please check your internet connection for the best experience.</p>
            <button class="connection-error-retry" id="connection-error-retry">Retry</button>
        </div>
    </div>
    
    <!-- Bottom Left Controls (Date & Comments) -->
    <div class="bottom-left-controls">
        <!-- Comments Viewer -->
        <div class="comments-viewer-container" id="comments-viewer-container">
            <button class="view-comments-btn" id="view-comments-btn">
                <span>Comments</span>
                <span class="comments-dropdown-arrow">▼</span>
            </button>
            <div class="comments-list-popup" id="comments-list-popup">
                <div class="comments-list-header">
                    <div class="comments-header-text">
                        <p class="comments-kicker">Live Feed</p>
                        <h3>All Comments</h3>
                        <p class="comments-subtitle">Active flags across the site</p>
                    </div>
                    <div class="comments-header-badges">
                        <span class="comment-pill comment-pill-live">Live</span>
                        <span class="comment-pill comment-pill-count" id="comments-count-badge">0 open</span>
                    </div>
                </div>
                <div class="comments-list-content" id="comments-list-content">
                    <!-- Comments will be populated by JavaScript -->
                </div>
                <div class="comments-list-footer">
                    <button class="resolved-comments-btn" id="resolved-comments-trigger">
                        <span class="resolved-btn-icon">✔︎</span>
                        <span class="resolved-btn-copy">
                            Resolved Comments
                            <small>View archive</small>
                        </span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Date and Time -->
        <div class="date-time-container" id="date-time-container">
            <button class="date-time" id="date-time-trigger">
                <span>25th Aug, 3:15 PM</span>
                <span class="date-dropdown-arrow">▼</span>
            </button>
            <div class="calendar-picker" id="calendar-picker">
                <div class="calendar-header">
                    <button class="calendar-nav-btn" id="prev-month">‹</button>
                    <div class="calendar-month" id="calendar-month">August 2024</div>
                    <button class="calendar-nav-btn" id="next-month">›</button>
                </div>
                <div class="calendar-weekdays">
                    <div class="calendar-weekday">S</div>
                    <div class="calendar-weekday">M</div>
                    <div class="calendar-weekday">T</div>
                    <div class="calendar-weekday">W</div>
                    <div class="calendar-weekday">T</div>
                    <div class="calendar-weekday">F</div>
                    <div class="calendar-weekday">S</div>
                </div>
                <div class="calendar-days" id="calendar-days">
                    <!-- Days will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <div class="resolved-panel-overlay" id="resolved-panel-overlay"></div>
    <aside class="resolved-comments-panel" id="resolved-comments-panel">
        <div class="resolved-panel-header">
            <div class="resolved-panel-titles">
                <p class="resolved-kicker">Archive</p>
                <h3>Resolved Comments</h3>
                <p class="resolved-subtitle">Everything that’s been marked done, sorted by location.</p>
            </div>
            <button class="resolved-panel-close" id="resolved-panel-close" aria-label="Close resolved comments">✕</button>
        </div>
        <div class="resolved-comments-list" id="resolved-comments-list">
            <!-- Resolved comments populated by JavaScript -->
        </div>
    </aside>
    <!-- Mini-map Navigation -->
    <div class="minimap-container" id="minimap-container">
        <div class="minimap-title">
            <select class="floor-dropdown" id="floor-dropdown">
                <option value="ground">Ground Floor</option>
                <option value="3rd" selected>3rd Floor</option>
                <option value="roof">Roof</option>
            </select>
        </div>
        <button class="minimap-toggle" id="minimap-toggle">−</button>
        <div class="minimap-instructions">*Click on blue dots to jump steps</div>
        <img class="minimap-bg" src="data/floorplans/floor_3_plan.png" alt="Map background">
        <div class="minimap-svg" id="minimap-svg"></div>
    </div>
    
    <!-- Comment Tooltip -->
    <div class="comment-tooltip-2d" id="comment-tooltip-2d">
        Debris Uncleared
    </div>
    
    <!-- Comment Popup -->
    <div class="comment-overlay" id="comment-overlay"></div>
    <div class="comment-popup" id="comment-popup">
        <div class="comment-popup-top">
            <div class="comment-risk-badge" id="comment-risk-badge">NORMAL RISK</div>
            <button class="comment-close" id="comment-close">×</button>
        </div>
        <h3 class="comment-title" id="comment-title">Comment Title</h3>
        <p class="comment-description" id="comment-description">Comment description goes here.</p>
        <div class="comment-thread-card">
            <div class="comment-thread-header">
                <div class="comment-thread-title">
                    <span class="comment-thread-label">Replies</span>
                </div>
                <span class="comment-thread-count" id="comment-thread-count">0</span>
            </div>
            <div class="comment-thread-list" id="comment-thread-list"></div>
            <div class="comment-reply-box">
                <div class="comment-reply-input" id="comment-reply-input" contenteditable="true" data-placeholder="Reply to this comment..."></div>
                <div class="comment-reply-actions">
                    <button class="comment-reply-send" id="comment-reply-send" disabled>Reply</button>
                </div>
            </div>
        </div>
        <button class="comment-delete" id="comment-delete">Delete</button>
    </div>

    <!-- Add Comment Helpers -->
    <div class="add-comment-hint" id="add-comment-hint">Click the 360° view to place a sticky note</div>
    <div class="add-comment-composer" id="add-comment-composer">
        <div class="add-comment-header">
            <div class="add-comment-title">Drop a sticky note</div>
            <div class="add-comment-subtitle">Pinned to the spot you just clicked</div>
        </div>
        <div class="add-comment-fields">
            <input type="text" id="add-comment-input" placeholder="Type your comment" autocomplete="off" />
            <select id="add-comment-risk">
                <option value="normal">Normal</option>
                <option value="medium">Medium</option>
                <option value="high">High</option>
                <option value="info">Info</option>
            </select>
        </div>
        <div class="add-comment-actions">
            <button class="add-comment-cancel" id="add-comment-cancel">Cancel</button>
            <button class="add-comment-save" id="add-comment-save" disabled>Post</button>
        </div>
    </div>

    <!-- Main JavaScript -->
    <script src="main.js"></script>
</body>
</html>
